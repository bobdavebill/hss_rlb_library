<!DOCTYPE html>
<html>
<head>
  <title>HSS Rani Lakshmibai Shakha Library</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  color: #ea5207;
  font-family: "Arial", sans-serif;
  margin: 0;
  padding: 15px;
  text-align: center;
  background: #fff;
}

img {
  max-width: 100%;
  height: auto;
}

h2 {
  font-size: 1.5rem;
  margin: 15px 0;
}

label {
  display: block;
  text-align: left;
  margin: 8px 0 4px;
}

input {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
  box-sizing: border-box;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: bold;
  background: #fff0e6;
  color: #ea5207;
  cursor: pointer;
}

button:hover {
  background: #ffe5d6;
}

#result {
  width: 100%;
  height: 150px;
  margin-top: 15px;
  resize: none;
  border: none;
  outline: none;
  background: #f9f9f9;
  font-family: inherit;
  font-size: 14px;
  border-radius: 8px;
  padding: 10px;
  box-sizing: border-box;
}

#confirmBtn {
  display: none;
}

pre#output {
  margin-top: 15px;
  white-space: pre-wrap;
  text-align: left;
  font-size: 14px;
}
</style>

</head>
<body>
  <img src="logo.png" alt="Library Logo">
  <h2>HSS Rani Lakshmibai Shakha Library</h2>

  <label for="nameInput">Name:</label>
  <input type="text" id="nameInput">

  <label for="bookInput">Book:</label>
  <input type="text" id="bookInput">

  <button onclick="borrowBook()">Borrow</button>
  <button onclick="returnBook()">Return</button>

  <textarea id="result" readonly></textarea>
  <button id="confirmBtn" onclick="confirmAction()">Confirm</button>

  <pre id="output"></pre>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzZnKHU2PqUXi0OLmpTEVYHqy8UoAzsWd30ARnqJSh4vspz7nZrWZl846hXAgJvKwTQ/exec"; 
  const sheetURL = "https://docs.google.com/spreadsheets/d/1r64xu7QXeSmqGn5WD1aCZDK2EPnM5XXQA0M-OJiRQcc/export?format=csv&gid=0"; 
  let sheetData = [];
  let pendingAction = null;

  fetch(sheetURL)
    .then(res => res.text())
    .then(csv => {
      sheetData = csv.split("\n").map(r => r.split(","));
    });

  function findBook() {
    const bookId = document.getElementById("bookInput").value.trim();
    const resultBox = document.getElementById("result");

    if (!bookId) {
      resultBox.value = "Please enter a Book Number.";
      return false;
    }

    const row = sheetData.find((r, i) => i > 0 && r[0] === bookId);

    if (row) {
      resultBox.value =
        `Book Name: ${row[1]}\n` +
        `Publisher: ${row[4]}\n` +
        `Author: ${row[5]}\n\n` +
        "Press Confirm if this is correct.";
      document.getElementById("confirmBtn").style.display = "block";
      return true;
    } else {
      resultBox.value = "Book Number not found.";
      document.getElementById("confirmBtn").style.display = "none";
      return false;
    }
  }

  function borrowBookOnSheet() {
    let name = document.getElementById("nameInput").value.trim();
    let book = document.getElementById("bookInput").value.trim();

    let data = new URLSearchParams();
    data.append("name", name);
    data.append("book", book);

    fetch(scriptURL, {
      method: "POST",
      body: data,
      headers: { "Content-Type": "application/x-www-form-urlencoded" }
    })
    .then(res => res.json())
    .then(() => {
      document.getElementById("output").textContent = "The book has been borrowed.";
    })
    .catch(err => {
      document.getElementById("output").textContent = "Error: " + err;
    });
  }

  function returnBookOnSheet() {
    let name = "In box";
    let book = document.getElementById("bookInput").value.trim();

    let data = new URLSearchParams();
    data.append("name", name);
    data.append("book", book);

    fetch(scriptURL, {
      method: "POST",
      body: data,
      headers: { "Content-Type": "application/x-www-form-urlencoded" }
    })
    .then(res => res.json())
    .then(() => {
      document.getElementById("output").textContent = "The book has been returned.";
    })
    .catch(err => {
      document.getElementById("output").textContent = "Error: " + err;
    });
  }

  function borrowBook() {
    if (findBook()) {
      pendingAction = "borrow";
    }
  }

  function returnBook() {
    if (findBook()) {
      pendingAction = "return";
    }
  }

  function confirmAction() {
    if (pendingAction === "borrow") {
      borrowBookOnSheet();
    } else if (pendingAction === "return") {
      returnBookOnSheet();
    }
    pendingAction = null;
    document.getElementById("confirmBtn").style.display = "none";
  }
</script>
</body>
</html>
